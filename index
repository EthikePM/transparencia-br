<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TransparênciaBR — Plataforma Nacional de Dados Públicos</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root {
  /* Paleta institucional — branco, prata, azul */
  --white:    #ffffff;
  --bg:       #f5f6f8;
  --bg2:      #eef0f4;
  --bg3:      #e4e7ed;
  --border:   #d1d6e0;
  --border2:  #b8bfcc;
  --silver:   #8a94a8;
  --ink:      #111827;
  --ink2:     #374151;
  --ink3:     #6b7280;

  /* Azul institucional */
  --blue:     #1a56db;
  --blue2:    #1e429f;
  --blue3:    #e8eeff;
  --blue4:    #c7d7fd;

  /* Exposição estatística — sem vermelho agressivo */
  --exp-alta:     #b91c1c;
  --exp-alta-bg:  #fef2f2;
  --exp-alta-bd:  #fecaca;
  --exp-mod:      #c2610c;
  --exp-mod-bg:   #fff7ed;
  --exp-mod-bd:   #fed7aa;
  --exp-baixa:    #15803d;
  --exp-baixa-bg: #f0fdf4;
  --exp-baixa-bd: #bbf7d0;

  --shadow-sm: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
  --shadow:    0 4px 16px rgba(0,0,0,0.08), 0 1px 4px rgba(0,0,0,0.04);
  --shadow-lg: 0 12px 40px rgba(0,0,0,0.10), 0 4px 12px rgba(0,0,0,0.05);
}

*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior:smooth; font-size:16px; }
body {
  background:var(--bg);
  color:var(--ink);
  font-family:'Sora', sans-serif;
  min-height:100vh;
  -webkit-font-smoothing:antialiased;
}

/* ═══ TOPBAR ═══ */
.topbar {
  background:var(--white);
  border-bottom:1px solid var(--border);
  height:56px;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 32px;
  position:sticky;top:0;z-index:500;
  box-shadow:var(--shadow-sm);
}
.brand {
  display:flex;align-items:center;gap:12px;
  text-decoration:none;
}
.brand-mark {
  width:32px;height:32px;
  background:var(--blue2);
  border-radius:6px;
  display:flex;align-items:center;justify-content:center;
}
.brand-mark svg { width:18px;height:18px; }
.brand-name {
  font-family:'Playfair Display',serif;
  font-size:17px;font-weight:700;
  color:var(--ink);letter-spacing:-0.3px;
}
.brand-name span { color:var(--blue); }
.brand-badge {
  font-family:'JetBrains Mono',monospace;
  font-size:8px;color:var(--silver);
  letter-spacing:2px;text-transform:uppercase;
  background:var(--bg2);border:1px solid var(--border);
  padding:2px 7px;border-radius:3px;
}

.nav-tabs {
  display:flex;gap:2px;
}
.nav-tab {
  font-size:12px;font-weight:500;
  color:var(--ink3);padding:6px 14px;
  border-radius:5px;cursor:pointer;
  transition:all .15s;border:none;background:none;
  font-family:'Sora',sans-serif;
}
.nav-tab:hover{background:var(--bg2);color:var(--ink);}
.nav-tab.active{background:var(--blue3);color:var(--blue2);font-weight:600;}

.mode-toggle {
  display:flex;align-items:center;gap:8px;
  background:var(--bg2);border:1px solid var(--border);
  border-radius:6px;padding:4px;
}
.mode-btn {
  font-family:'JetBrains Mono',monospace;
  font-size:9px;letter-spacing:1px;text-transform:uppercase;
  padding:4px 10px;border-radius:4px;cursor:pointer;
  border:none;background:none;color:var(--silver);
  transition:all .15s;
}
.mode-btn.active{background:var(--white);color:var(--blue2);font-weight:500;box-shadow:var(--shadow-sm);}

@media(max-width:680px){.nav-tabs{display:none;}}

/* ═══ VIEWS ═══ */
.view{display:none;animation:fadeUp .3s ease both;}
.view.active{display:block;}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);}}

/* ═══════════════ HOME ═══════════════ */
.home-hero {
  background:var(--white);
  border-bottom:1px solid var(--border);
  padding:56px 32px 48px;
  text-align:center;
}
.hero-label {
  font-family:'JetBrains Mono',monospace;
  font-size:10px;letter-spacing:3px;color:var(--blue);
  text-transform:uppercase;margin-bottom:16px;
  display:flex;align-items:center;justify-content:center;gap:8px;
}
.hero-label::before,.hero-label::after{content:'';width:24px;height:1px;background:var(--blue4);}
.hero-h1 {
  font-family:'Playfair Display',serif;
  font-size:clamp(32px,5vw,52px);
  font-weight:900;line-height:1.08;
  color:var(--ink);margin-bottom:16px;letter-spacing:-1px;
}
.hero-h1 em{font-style:italic;color:var(--blue);}
.hero-sub {
  font-size:15px;color:var(--ink3);
  line-height:1.7;max-width:600px;
  margin:0 auto 32px;
}

/* Search */
.search-container {max-width:680px;margin:0 auto;}
.search-wrap {
  display:flex;background:var(--white);
  border:2px solid var(--border);border-radius:10px;
  overflow:hidden;box-shadow:var(--shadow);
  transition:border-color .2s,box-shadow .2s;
}
.search-wrap:focus-within{border-color:var(--blue);box-shadow:0 0 0 4px rgba(26,86,219,.1),var(--shadow);}
.search-input {
  flex:1;border:none;background:transparent;
  padding:15px 20px;font-family:'Sora',sans-serif;
  font-size:15px;color:var(--ink);outline:none;
}
.search-input::placeholder{color:var(--silver);}
.search-btn {
  background:var(--blue2);border:none;
  padding:15px 28px;color:var(--white);
  font-family:'Sora',sans-serif;font-weight:600;font-size:13px;
  cursor:pointer;transition:background .15s;white-space:nowrap;
  display:flex;align-items:center;gap:7px;
}
.search-btn:hover{background:var(--blue);}
.search-types {
  display:flex;gap:6px;margin-top:10px;justify-content:center;flex-wrap:wrap;
}
.search-type {
  font-family:'JetBrains Mono',monospace;font-size:9px;
  letter-spacing:1px;text-transform:uppercase;
  color:var(--silver);background:var(--white);
  border:1px solid var(--border);
  padding:4px 12px;border-radius:100px;
  cursor:pointer;transition:all .15s;
}
.search-type:hover,.search-type.active{background:var(--blue3);color:var(--blue2);border-color:var(--blue4);}

/* Source chips */
.sources-strip {
  display:flex;align-items:center;justify-content:center;
  gap:6px;flex-wrap:wrap;
  margin-top:16px;
}
.src-chip {
  font-family:'JetBrains Mono',monospace;font-size:9px;
  color:var(--ink3);background:var(--bg2);
  border:1px solid var(--border);
  padding:3px 10px;border-radius:100px;
  text-decoration:none;transition:all .15s;letter-spacing:.3px;
}
.src-chip:hover{background:var(--blue3);color:var(--blue2);border-color:var(--blue4);}

/* Top estatístico */
.home-section{max-width:980px;margin:0 auto;padding:40px 24px;}
.section-label {
  font-family:'JetBrains Mono',monospace;
  font-size:9px;letter-spacing:3px;color:var(--blue);
  text-transform:uppercase;margin-bottom:6px;
}
.section-h2 {
  font-family:'Playfair Display',serif;
  font-size:22px;font-weight:700;color:var(--ink);
  margin-bottom:4px;
}
.section-sub{font-size:13px;color:var(--ink3);line-height:1.6;margin-bottom:24px;}

.stat-cards {
  display:grid;grid-template-columns:repeat(4,1fr);gap:12px;
  margin-bottom:40px;
}
.stat-card {
  background:var(--white);border:1px solid var(--border);
  border-radius:10px;padding:20px;box-shadow:var(--shadow-sm);
  border-top:3px solid var(--blue);
}
.sc-val {
  font-family:'Playfair Display',serif;
  font-size:28px;font-weight:900;color:var(--ink);margin-bottom:4px;
}
.sc-label{font-size:11px;color:var(--ink3);font-weight:500;}
.sc-sub{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);margin-top:4px;}

/* Ranking cards */
.ranking-grid{display:flex;flex-direction:column;gap:8px;}
.rank-card {
  background:var(--white);border:1px solid var(--border);
  border-radius:10px;display:flex;align-items:stretch;
  box-shadow:var(--shadow-sm);cursor:pointer;overflow:hidden;
  transition:box-shadow .15s,border-color .15s,transform .12s;
  text-decoration:none;
}
.rank-card:hover{box-shadow:var(--shadow);border-color:var(--border2);transform:translateX(3px);}
.rank-num-block {
  width:56px;background:var(--ink);
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;gap:2px;flex-shrink:0;
}
.rank-num{font-family:'Playfair Display',serif;font-weight:900;font-size:22px;color:var(--white);}
.rank-lbl{font-family:'JetBrains Mono',monospace;font-size:7px;color:rgba(255,255,255,.35);letter-spacing:1px;}
.rank-body{flex:1;padding:14px 18px;}
.rank-name{font-weight:600;font-size:14px;color:var(--ink);margin-bottom:3px;}
.rank-role{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--silver);margin-bottom:8px;}
.rank-tags{display:flex;gap:5px;flex-wrap:wrap;}
.tag {
  font-family:'JetBrains Mono',monospace;font-size:8px;
  padding:2px 8px;border-radius:3px;letter-spacing:.5px;text-transform:uppercase;
}
.tag-alta{background:var(--exp-alta-bg);color:var(--exp-alta);border:1px solid var(--exp-alta-bd);}
.tag-mod{background:var(--exp-mod-bg);color:var(--exp-mod);border:1px solid var(--exp-mod-bd);}
.tag-baixa{background:var(--exp-baixa-bg);color:var(--exp-baixa);border:1px solid var(--exp-baixa-bd);}
.rank-right {
  padding:14px 18px;display:flex;flex-direction:column;
  align-items:flex-end;justify-content:center;
  border-left:1px solid var(--border);min-width:130px;gap:4px;
}
.iee-val{font-family:'Playfair Display',serif;font-weight:900;font-size:28px;}
.iee-lbl{font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--silver);letter-spacing:1px;text-transform:uppercase;}
.rank-exp{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--ink2);}

/* ═══════════════ ANÁLISE ═══════════════ */
.analysis-wrap{max-width:980px;margin:0 auto;padding:24px;}

/* Loading */
.loading-card {
  background:var(--white);border:1px solid var(--border);
  border-radius:12px;padding:32px;box-shadow:var(--shadow);
  display:none;
}
.loading-card.visible{display:block;}
.ld-header{display:flex;align-items:center;gap:12px;margin-bottom:20px;}
.ld-spinner {
  width:20px;height:20px;border:2px solid var(--border);
  border-top-color:var(--blue);border-radius:50%;
  animation:spin .7s linear infinite;flex-shrink:0;
}
@keyframes spin{to{transform:rotate(360deg);}}
.ld-title{font-family:'JetBrains Mono',monospace;font-size:11px;letter-spacing:1.5px;color:var(--ink2);text-transform:uppercase;}
.ld-bar-wrap{height:3px;background:var(--bg2);border-radius:2px;overflow:hidden;margin-bottom:20px;}
.ld-bar{height:100%;background:linear-gradient(90deg,var(--blue2),var(--blue));width:0%;transition:width .4s ease;border-radius:2px;}
.ld-steps{display:flex;flex-direction:column;gap:8px;}
.ld-step{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--border2);display:flex;align-items:center;gap:10px;transition:color .3s;}
.ld-dot{width:6px;height:6px;border-radius:50%;background:var(--border);flex-shrink:0;transition:all .3s;}
.ld-step.active{color:var(--ink);}
.ld-step.active .ld-dot{background:var(--blue);animation:pulse .8s ease-in-out infinite;}
.ld-step.done{color:var(--exp-baixa);}
.ld-step.done .ld-dot{background:var(--exp-baixa);}
@keyframes pulse{50%{opacity:.2;}}

/* Results */
.results-wrap{display:none;}
.results-wrap.visible{display:block;}

/* Subject card */
.subject-card {
  background:var(--white);border:1px solid var(--border);
  border-radius:12px;overflow:hidden;
  box-shadow:var(--shadow);margin-bottom:16px;
}
.sc-top{
  background:var(--ink);padding:24px 28px;
  display:flex;justify-content:space-between;align-items:flex-start;
  gap:16px;flex-wrap:wrap;
}
.sc-left{}
.sc-type{font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:2px;color:rgba(255,255,255,.4);text-transform:uppercase;margin-bottom:6px;}
.sc-name{font-family:'Playfair Display',serif;font-size:24px;font-weight:900;color:var(--white);margin-bottom:10px;}
.sc-pills{display:flex;flex-wrap:wrap;gap:5px;}
.sc-pill{font-family:'JetBrains Mono',monospace;font-size:9px;color:rgba(255,255,255,.45);background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);padding:3px 9px;border-radius:100px;}
.sc-right{text-align:right;flex-shrink:0;}
.sc-iee-label{font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:2px;color:rgba(255,255,255,.3);text-transform:uppercase;margin-bottom:4px;}
.sc-iee-val{font-family:'Playfair Display',serif;font-weight:900;font-size:40px;line-height:1;}
.sc-iee-class{font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:1px;text-transform:uppercase;margin-top:4px;}
.sc-bottom{padding:16px 28px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;border-top:1px solid var(--bg2);}

/* Buttons */
.btn{font-family:'Sora',sans-serif;font-weight:600;font-size:12px;padding:8px 16px;border-radius:6px;border:none;cursor:pointer;transition:all .15s;display:inline-flex;align-items:center;gap:6px;text-decoration:none;}
.btn-primary{background:var(--blue2);color:var(--white);}
.btn-primary:hover{background:var(--blue);}
.btn-outline{background:var(--white);color:var(--ink2);border:1px solid var(--border);}
.btn-outline:hover{background:var(--bg2);border-color:var(--border2);}
.btn-source{background:var(--blue3);color:var(--blue2);border:1px solid var(--blue4);}
.btn-source:hover{background:var(--blue4);}
.btn-sm{font-size:11px;padding:5px 12px;}

/* Grid layout */
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px;}
.three-col{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:14px;}
.full-col{margin-bottom:14px;}

/* Cards */
.card{background:var(--white);border:1px solid var(--border);border-radius:10px;box-shadow:var(--shadow-sm);overflow:hidden;}
.card-header{padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:10px;}
.card-title{font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--silver);text-transform:uppercase;}
.card-body{padding:20px;}
.card-body-sm{padding:14px 20px;}

/* IEE Formula box */
.iee-formula {
  background:var(--bg2);border:1px solid var(--border);
  border-radius:8px;padding:16px;margin-bottom:14px;
  font-family:'JetBrains Mono',monospace;font-size:11px;
  color:var(--ink2);line-height:1.8;
}
.iee-formula strong{color:var(--blue2);}
.iee-vars{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px;}
.iee-var{background:var(--white);border:1px solid var(--border);border-radius:6px;padding:10px 14px;}
.iee-var-name{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);letter-spacing:1px;text-transform:uppercase;margin-bottom:3px;}
.iee-var-val{font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:var(--ink);}
.iee-var-norm{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--blue2);margin-top:2px;}
.iee-var-weight{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);}

/* Score bar */
.score-track{height:8px;background:var(--bg2);border-radius:100px;overflow:hidden;margin:10px 0;}
.score-fill{height:100%;border-radius:100px;transition:width 1s cubic-bezier(.4,0,.2,1);width:0%;}
.fill-alta{background:linear-gradient(90deg,var(--exp-mod),var(--exp-alta));}
.fill-mod{background:linear-gradient(90deg,var(--exp-baixa),var(--exp-mod));}
.fill-baixa{background:var(--exp-baixa);}

/* Avisos legais */
.aviso {
  background:var(--blue3);border:1px solid var(--blue4);
  border-radius:8px;padding:12px 16px;
  font-size:12px;color:var(--blue2);line-height:1.6;
  margin-bottom:14px;
  display:flex;gap:10px;align-items:flex-start;
}
.aviso-icon{flex-shrink:0;font-size:14px;margin-top:1px;}

/* Chart containers */
.chart-wrap{position:relative;height:200px;}
.chart-wrap-lg{position:relative;height:260px;}

/* Timeline */
.timeline{display:flex;flex-direction:column;}
.tl-item{display:flex;gap:14px;padding-bottom:16px;position:relative;}
.tl-item::before{content:'';position:absolute;left:38px;top:18px;bottom:0;width:1px;background:var(--border);}
.tl-item:last-child::before{display:none;}
.tl-year{font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:500;color:var(--white);background:var(--ink);padding:3px 6px;border-radius:4px;height:22px;display:flex;align-items:center;flex-shrink:0;width:48px;justify-content:center;position:relative;z-index:1;}
.tl-dot{width:10px;height:10px;border-radius:50%;border:2px solid var(--border);background:var(--bg);flex-shrink:0;margin-top:5px;position:relative;z-index:1;}
.tl-item.alta .tl-dot{border-color:var(--exp-alta);background:var(--exp-alta);}
.tl-item.mod .tl-dot{border-color:var(--exp-mod);background:var(--exp-mod);}
.tl-event{font-weight:600;font-size:13px;color:var(--ink);margin-bottom:2px;}
.tl-desc{font-size:12px;color:var(--ink3);line-height:1.55;}
.tl-source{margin-top:4px;}

/* Variáveis de exposição */
.var-list{display:flex;flex-direction:column;gap:10px;}
.var-item{padding:12px 0;border-bottom:1px solid var(--bg2);}
.var-item:last-child{border-bottom:none;}
.var-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;}
.var-name{font-size:13px;font-weight:500;color:var(--ink);}
.var-score{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:500;}
.var-desc{font-size:12px;color:var(--ink3);line-height:1.5;margin-bottom:6px;}
.var-bar{height:5px;background:var(--bg2);border-radius:100px;overflow:hidden;}
.var-bar-fill{height:100%;border-radius:100px;transition:width 1s cubic-bezier(.4,0,.2,1);width:0%;}

/* Cargos comissionados */
.cargo-item{border-bottom:1px solid var(--bg2);padding:16px 0;}
.cargo-item:last-child{border-bottom:none;}
.cargo-row1{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.das-badge{font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:500;padding:3px 9px;border-radius:4px;letter-spacing:1px;background:var(--ink);color:var(--white);flex-shrink:0;}
.das-badge.alto{background:var(--blue2);}
.cargo-nome{font-weight:600;font-size:14px;color:var(--ink);flex:1;}
.cargo-orgao{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);}
.cargo-stats{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px;}
.cargo-stat{background:var(--bg2);border:1px solid var(--border);border-radius:6px;padding:8px 12px;flex:1;min-width:90px;}
.cs-lbl{font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--silver);letter-spacing:1px;text-transform:uppercase;margin-bottom:3px;}
.cs-vl{font-family:'Playfair Display',serif;font-size:16px;font-weight:700;color:var(--ink);}
.cs-sub{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);margin-top:1px;}
.repasse-box{background:var(--exp-alta-bg);border:1px solid var(--exp-alta-bd);border-radius:6px;padding:12px 14px;}
.repasse-title{font-weight:600;font-size:12px;color:var(--exp-alta);margin-bottom:4px;}
.repasse-desc{font-size:12px;color:var(--ink2);line-height:1.55;margin-bottom:6px;}
.repasse-val{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--exp-alta);font-weight:500;}

/* Partido */
.partido-header{background:var(--ink);padding:16px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px;}
.partido-sigla{font-family:'Playfair Display',serif;font-weight:900;font-size:16px;color:var(--white);background:var(--blue2);width:42px;height:42px;border-radius:7px;display:flex;align-items:center;justify-content:center;flex-shrink:0;letter-spacing:.5px;}
.partido-info{flex:1;}
.partido-nome{font-weight:600;font-size:15px;color:var(--white);margin-bottom:2px;}
.partido-meta{font-family:'JetBrains Mono',monospace;font-size:9px;color:rgba(255,255,255,.4);}
.partido-risk{text-align:right;flex-shrink:0;}
.partido-risk-val{font-family:'Playfair Display',serif;font-weight:900;font-size:22px;color:#fca5a5;}
.partido-risk-lbl{font-family:'JetBrains Mono',monospace;font-size:8px;color:rgba(255,255,255,.3);letter-spacing:1px;}
.alliance-list{display:flex;flex-direction:column;gap:7px;}
.alliance-item{display:flex;align-items:center;gap:12px;padding:10px 14px;background:var(--bg);border:1px solid var(--border);border-radius:6px;cursor:pointer;transition:all .12s;}
.alliance-item:hover{background:var(--white);border-color:var(--border2);}
.al-sigla{font-family:'Playfair Display',serif;font-weight:900;font-size:10px;width:34px;height:34px;border-radius:6px;display:flex;align-items:center;justify-content:center;flex-shrink:0;color:var(--white);}
.al-name{font-weight:600;font-size:13px;color:var(--ink);}
.al-role{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);margin-top:1px;}
.al-link{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--ink3);margin-top:2px;}
.al-iee{text-align:right;flex-shrink:0;}
.al-iee-val{font-family:'Playfair Display',serif;font-weight:900;font-size:18px;}
.al-iee-lbl{font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--silver);}

/* Obras */
.obra-item{border-bottom:1px solid var(--bg2);padding:16px 0;}
.obra-item:last-child{border-bottom:none;}
.obra-row1{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:10px;}
.obra-nome{font-weight:600;font-size:13px;color:var(--ink);flex:1;}
.obra-var{text-align:right;flex-shrink:0;}
.obra-var-val{font-family:'Playfair Display',serif;font-weight:900;font-size:20px;}
.obra-var-lbl{font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--silver);letter-spacing:1px;}
.obra-stats{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;}
.obra-stat{background:var(--bg2);border:1px solid var(--border);border-radius:5px;padding:7px 11px;flex:1;min-width:80px;}
.os-lbl{font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--silver);letter-spacing:1px;text-transform:uppercase;margin-bottom:2px;}
.os-vl{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:500;color:var(--ink);}
.obra-compare{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--ink3);display:flex;align-items:center;gap:6px;margin-top:6px;}
.obra-compare span{color:var(--exp-mod);font-weight:500;}

/* Conexões */
.conn-item{display:flex;align-items:center;gap:12px;padding:11px 14px;background:var(--bg);border:1px solid var(--border);border-radius:6px;margin-bottom:7px;transition:all .12s;}
.conn-item:last-child{margin-bottom:0;}
.conn-item:hover{background:var(--white);border-color:var(--border2);}
.ct{font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--silver);letter-spacing:1px;text-transform:uppercase;width:76px;flex-shrink:0;}
.cn{flex:1;}
.cn-name{font-weight:600;font-size:13px;color:var(--ink);}
.cn-cnpj{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);margin-top:1px;}
.cn-val{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:500;text-align:right;}
.cn-tag{font-family:'JetBrains Mono',monospace;font-size:8px;padding:2px 7px;border-radius:3px;letter-spacing:.5px;flex-shrink:0;}

/* Fonte verify button */
.verify-btn{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--blue);background:var(--blue3);border:1px solid var(--blue4);padding:2px 8px;border-radius:3px;text-decoration:none;transition:all .12s;flex-shrink:0;}
.verify-btn:hover{background:var(--blue);color:var(--white);}

/* Source rows */
.source-row{display:flex;align-items:center;gap:10px;padding:8px 14px;background:var(--bg);border:1px solid var(--border);border-radius:5px;margin-bottom:5px;transition:border-color .12s;}
.source-row:hover{border-color:var(--blue4);}
.sr-name{font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:500;color:var(--ink2);width:160px;flex-shrink:0;}
.sr-url{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--blue);text-decoration:none;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.sr-url:hover{text-decoration:underline;}
.sr-ts{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);flex-shrink:0;}

/* Simple mode overlay */
.simple-card{background:var(--blue3);border:1px solid var(--blue4);border-radius:8px;padding:12px 16px;margin-bottom:10px;font-size:13px;color:var(--ink2);line-height:1.65;border-left:3px solid var(--blue2);}
.simple-label{font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1.5px;color:var(--blue);text-transform:uppercase;margin-bottom:5px;}

/* Disclaimer */
.disclaimer-box{background:var(--white);border:1px solid var(--border);border-radius:8px;padding:14px 18px;margin-top:20px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--silver);line-height:1.7;}
.disclaimer-box strong{color:var(--ink3);}
.disclaimer-box a{color:var(--blue);text-decoration:none;}
.disclaimer-box a:hover{text-decoration:underline;}

/* Tab filters */
.filter-tabs{display:flex;gap:2px;border-bottom:2px solid var(--border);margin-bottom:14px;}
.tab{font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:1.5px;text-transform:uppercase;padding:8px 14px;cursor:pointer;color:var(--silver);border-bottom:2px solid transparent;margin-bottom:-2px;transition:all .15s;background:none;border-left:none;border-right:none;border-top:none;}
.tab:hover{color:var(--ink2);}
.tab.active{color:var(--blue2);border-bottom-color:var(--blue);}
.tab-count{display:inline-block;background:var(--bg2);border-radius:3px;padding:1px 6px;font-size:8px;margin-left:4px;color:var(--silver);}
.tab.active .tab-count{background:var(--blue);color:var(--white);}

/* Obras view */
.obras-wrap{max-width:980px;margin:0 auto;padding:24px;}

/* Methodology */
.method-wrap{max-width:860px;margin:0 auto;padding:40px 24px;}
.method-h{font-family:'Playfair Display',serif;font-size:24px;font-weight:700;color:var(--ink);margin-bottom:12px;}
.method-p{font-size:14px;color:var(--ink2);line-height:1.75;margin-bottom:14px;}
.method-formula{
  background:var(--ink);color:var(--white);
  border-radius:8px;padding:20px 24px;
  font-family:'JetBrains Mono',monospace;font-size:13px;
  line-height:1.9;margin:20px 0;
}
.method-formula .highlight{color:#93c5fd;}
.method-formula .comment{color:rgba(255,255,255,.35);font-size:11px;}
.endpoint-list{display:flex;flex-direction:column;gap:8px;margin:16px 0;}
.endpoint-item{background:var(--white);border:1px solid var(--border);border-radius:6px;padding:12px 16px;}
.ep-method{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--white);background:var(--blue2);padding:2px 6px;border-radius:3px;margin-right:8px;}
.ep-url{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--blue);}
.ep-desc{font-size:11px;color:var(--ink3);margin-top:4px;}

/* Responsive */
@media(max-width:680px){
  .stat-cards{grid-template-columns:1fr 1fr;}
  .two-col,.three-col{grid-template-columns:1fr;}
  .iee-vars{grid-template-columns:1fr;}
  .topbar{padding:0 16px;}
  .home-hero{padding:36px 20px 32px;}
  .analysis-wrap,.home-section,.obras-wrap,.method-wrap{padding:16px;}
}
</style>
</head>
<body>

<!-- ═══ TOPBAR ═══ -->
<header class="topbar">
  <a class="brand" href="#" onclick="showView('home');return false;">
    <div class="brand-mark">
      <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>
      </svg>
    </div>
    <span class="brand-name">Transparência<span>BR</span></span>
    <span class="brand-badge">v1.0 · Open Source</span>
  </a>

  <div class="nav-tabs">
    <button class="nav-tab active" id="nt-home"     onclick="showView('home')">Início</button>
    <button class="nav-tab"        id="nt-analise"  onclick="showView('analise')">Analisar</button>
    <button class="nav-tab"        id="nt-obras"    onclick="showView('obras')">Obras Públicas</button>
    <button class="nav-tab"        id="nt-metodo"   onclick="showView('metodo')">Metodologia</button>
  </div>

  <div class="mode-toggle">
    <button class="mode-btn active" id="mb-simples" onclick="setMode('simples')">Simples</button>
    <button class="mode-btn"        id="mb-avancado" onclick="setMode('avancado')">Avançado</button>
  </div>
</header>

<!-- ═══════════════ HOME ═══════════════ -->
<div class="view active" id="view-home">

  <div class="home-hero">
    <div class="hero-label">Plataforma Nacional de Transparência Pública</div>
    <h1 class="hero-h1">Dados públicos,<br><em>análise independente.</em></h1>
    <p class="hero-sub">
      Consolidação automatizada de dados oficiais de 10 portais governamentais.
      Metodologia estatística auditável. Código open-source (MIT).
      Conformidade com LGPD e Marco Civil da Internet.
    </p>

    <div class="search-container">
      <div class="search-wrap">
        <input class="search-input" id="homeSearch" type="text"
          placeholder="Nome do agente público, CNPJ ou município..." autocomplete="off"/>
        <button class="search-btn" onclick="startSearch(document.getElementById('homeSearch').value)">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          Consultar
        </button>
      </div>
      <div class="search-types">
        <div class="search-type active" onclick="setSearchType(this,'nome')">Por nome</div>
        <div class="search-type" onclick="setSearchType(this,'cnpj')">Por CNPJ</div>
        <div class="search-type" onclick="setSearchType(this,'cargo')">Por cargo</div>
        <div class="search-type" onclick="setSearchType(this,'cpf')">Por CPF público</div>
      </div>
      <div class="sources-strip">
        <a class="src-chip" href="https://transparencia.gov.br" target="_blank">Transparência.gov</a>
        <a class="src-chip" href="https://compras.gov.br" target="_blank">Compras.gov</a>
        <a class="src-chip" href="https://divulgacandcontas.tse.jus.br" target="_blank">TSE</a>
        <a class="src-chip" href="https://www.receita.fazenda.gov.br" target="_blank">Receita Federal</a>
        <a class="src-chip" href="https://siafi.tesouro.gov.br" target="_blank">SIAFI</a>
        <a class="src-chip" href="https://portaldatransparencia.gov.br/sancoes" target="_blank">CGU/CEIS</a>
        <a class="src-chip" href="https://portal.tcu.gov.br" target="_blank">TCU</a>
        <a class="src-chip" href="https://www.fnde.gov.br" target="_blank">FNDE</a>
      </div>
    </div>
  </div>

  <div class="home-section">
    <div class="stat-cards">
      <div class="stat-card">
        <div class="sc-val">10</div>
        <div class="sc-label">Fontes Oficiais Integradas</div>
        <div class="sc-sub">APIs governamentais</div>
      </div>
      <div class="stat-card">
        <div class="sc-val">100%</div>
        <div class="sc-label">Dados Públicos</div>
        <div class="sc-sub">Sem dados mockados</div>
      </div>
      <div class="stat-card">
        <div class="sc-val">MIT</div>
        <div class="sc-label">Licença Open-Source</div>
        <div class="sc-sub">Código disponível no GitHub</div>
      </div>
      <div class="stat-card">
        <div class="sc-val">LGPD</div>
        <div class="sc-label">Conformidade Legal</div>
        <div class="sc-sub">Marco Civil da Internet</div>
      </div>
    </div>

    <div class="aviso">
      <div class="aviso-icon">ℹ</div>
      <div><strong>Nota metodológica:</strong> O Índice de Exposição Estatística (IEE) representa exclusivamente análise estatística de padrões em dados públicos e não constitui acusação, juízo moral ou comprovação de irregularidade. Cada dado possui link rastreável à fonte oficial.</div>
    </div>

    <div class="section-label">// Ranking estatístico</div>
    <div class="section-h2">Maiores IEE Identificados</div>
    <div class="section-sub">Baseado no cruzamento automático de dados públicos. Clique para ver o relatório técnico completo.</div>
    <div class="ranking-grid" id="rankingGrid"></div>
  </div>
</div>

<!-- ═══════════════ ANÁLISE ═══════════════ -->
<div class="view" id="view-analise">
  <div class="analysis-wrap">

    <div style="margin-bottom:14px;">
      <div class="search-wrap">
        <input class="search-input" id="analysisSearch" type="text" placeholder="Nome, CNPJ ou cargo..." autocomplete="off"/>
        <button class="search-btn" onclick="startSearch(document.getElementById('analysisSearch').value)">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          Consultar
        </button>
      </div>
    </div>

    <!-- Loading -->
    <div class="loading-card" id="loadingCard">
      <div class="ld-header">
        <div class="ld-spinner"></div>
        <div class="ld-title">Consultando bases de dados oficiais...</div>
      </div>
      <div class="ld-bar-wrap"><div class="ld-bar" id="ldBar"></div></div>
      <div class="ld-steps" id="ldSteps">
        <div class="ld-step" id="ls1"><div class="ld-dot"></div>Portal da Transparência — emendas, repasses, servidores</div>
        <div class="ld-step" id="ls2"><div class="ld-dot"></div>TSE — declaração de bens, doadores, prestação de contas</div>
        <div class="ld-step" id="ls3"><div class="ld-dot"></div>Receita Federal — quadro societário CNPJ</div>
        <div class="ld-step" id="ls4"><div class="ld-dot"></div>CGU / CEIS / CNEP — sanções e inidôneos</div>
        <div class="ld-step" id="ls5"><div class="ld-dot"></div>Compras.gov — contratos, licitações, fornecedores</div>
        <div class="ld-step" id="ls6"><div class="ld-dot"></div>SIAFI — execução orçamentária e financeira</div>
        <div class="ld-step" id="ls7"><div class="ld-dot"></div>FNDE + INEP — verbas educacionais × matrículas</div>
        <div class="ld-step" id="ls8"><div class="ld-dot"></div>RAIS/CAGED — vínculos empregatícios e duplo vínculo</div>
        <div class="ld-step" id="ls9"><div class="ld-dot"></div>Calculando IEE e gerando relatório técnico auditável...</div>
      </div>
    </div>

    <!-- Results -->
    <div class="results-wrap" id="resultsWrap">

      <!-- Subject -->
      <div class="subject-card full-col">
        <div class="sc-top">
          <div class="sc-left">
            <div class="sc-type" id="rType">—</div>
            <div class="sc-name" id="rName">—</div>
            <div class="sc-pills" id="rMeta"></div>
          </div>
          <div class="sc-right">
            <div class="sc-iee-label">Índice de Exposição Estatística</div>
            <div class="sc-iee-val" id="rIEE">—</div>
            <div class="sc-iee-class" id="rIEEClass">—</div>
          </div>
        </div>
        <div class="sc-bottom">
          <button class="btn btn-primary btn-sm" onclick="gerarPDF()">↓ Relatório Técnico PDF</button>
          <a class="btn btn-outline btn-sm" href="https://falabr.cgu.gov.br" target="_blank">Canal de Contestação — CGU</a>
          <a class="btn btn-outline btn-sm" href="https://portal.tcu.gov.br/ouvidoria" target="_blank">TCU Ouvidoria</a>
          <a class="btn btn-source btn-sm" id="rSourceBtn" href="#" target="_blank">Verificar na fonte oficial →</a>
        </div>
      </div>

      <div class="aviso" id="rAviso">
        <div class="aviso-icon">ℹ</div>
        <div id="rAvisoText"></div>
      </div>

      <!-- IEE + Chart row -->
      <div class="two-col">

        <!-- IEE Fórmula -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">IEE — Índice de Exposição Estatística</div>
            <button class="btn btn-outline btn-sm" onclick="showView('metodo')">Ver metodologia →</button>
          </div>
          <div class="card-body">
            <div style="display:flex;align-items:baseline;gap:10px;margin-bottom:10px;">
              <div style="font-family:'Playfair Display',serif;font-size:48px;font-weight:900;" id="ieeDisplay">—</div>
              <div>
                <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--silver);">/ 100</div>
                <div class="tag" id="ieeTag" style="margin-top:4px;">—</div>
              </div>
            </div>
            <div class="score-track"><div class="score-fill" id="ieeBar" data-w="0"></div></div>
            <div class="iee-formula" id="ieeFormula">—</div>
            <div class="iee-vars" id="ieeVars"></div>
          </div>
        </div>

        <!-- Radar/Bar chart -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">Distribuição por Variável</div>
          </div>
          <div class="card-body">
            <div class="chart-wrap-lg">
              <canvas id="chartVars"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Timeline + Pie -->
      <div class="two-col">
        <div class="card">
          <div class="card-header"><div class="card-title">Linha Temporal dos Dados</div></div>
          <div class="card-body-sm">
            <div class="timeline" id="rTimeline"></div>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-title">Composição da Exposição</div></div>
          <div class="card-body">
            <div class="chart-wrap"><canvas id="chartPie"></canvas></div>
            <div id="rStats" style="margin-top:12px;display:flex;flex-direction:column;gap:6px;"></div>
          </div>
        </div>
      </div>

      <!-- Variáveis detalhadas -->
      <div class="full-col card" id="varsSection" style="display:none;">
        <div class="card-header"><div class="card-title">Detalhamento das Variáveis Estatísticas</div></div>
        <div class="card-body">
          <div class="var-list" id="varList"></div>
        </div>
      </div>

      <!-- Partido -->
      <div class="full-col card">
        <div class="partido-header" id="partidoHeader"></div>
        <div class="card-body-sm">
          <div style="font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--silver);text-transform:uppercase;margin-bottom:12px;">Mapa de Conexões Estatísticas — Agentes com IEE Elevado</div>
          <div class="alliance-list" id="allianceList"></div>
        </div>
      </div>

      <!-- Cargos comissionados -->
      <div class="full-col card">
        <div class="card-header">
          <div class="card-title">Cargos Comissionados — Histórico</div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--ink2);" id="cargosTotal">—</div>
        </div>
        <div class="card-body">
          <div id="cargosList"></div>
        </div>
      </div>

      <!-- Conexões -->
      <div class="full-col card">
        <div class="card-header">
          <div class="card-title">Rede de Vínculos Identificados</div>
          <div id="connsCount" style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--silver);">—</div>
        </div>
        <div class="card-body-sm" id="connsList"></div>
      </div>

      <!-- Fontes consultadas -->
      <div class="full-col card">
        <div class="card-header">
          <div class="card-title">Fontes Consultadas — Rastreabilidade Total</div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);" id="rTimestamp">—</div>
        </div>
        <div class="card-body-sm" id="sourcesList"></div>
      </div>

      <div class="disclaimer-box">
        <strong>AVISO LEGAL — Relatório Técnico de Consolidação de Dados Públicos:</strong>
        Este documento consolida exclusivamente dados de portais oficiais do governo federal.
        O IEE representa análise estatística de padrões públicos e <strong>não constitui acusação, juízo moral ou comprovação de irregularidade.</strong>
        Dados sujeitos à contestação via:
        <a href="https://falabr.cgu.gov.br" target="_blank">CGU — Fala.BR</a> ·
        <a href="https://portal.tcu.gov.br/ouvidoria" target="_blank">TCU</a> ·
        <a href="https://www.mpf.mp.br/servicos/ouvidoria" target="_blank">MPF</a> ·
        <a href="https://www.pf.gov.br/servicos-pf/delegacias-online" target="_blank">PF</a>.
        Plataforma em conformidade com LGPD (Lei 13.709/2018) e Marco Civil da Internet (Lei 12.965/2014).
        ANPD: <a href="https://www.gov.br/anpd" target="_blank">gov.br/anpd</a>
      </div>
    </div>
  </div>
</div>

<!-- ═══════════════ OBRAS ═══════════════ -->
<div class="view" id="view-obras">
  <div class="obras-wrap">
    <div class="section-label">// Módulo específico</div>
    <div class="section-h2" style="margin-bottom:4px;">Análise Estatística de Obras Públicas</div>
    <div class="section-sub">Variação percentual entre valor inicial e final. Nunca classificado como "superfaturamento" — apenas estatística descritiva comparada à média nacional da mesma modalidade.</div>

    <div class="aviso" style="margin-bottom:20px;">
      <div class="aviso-icon">ℹ</div>
      <div>Variação = (Valor Final – Valor Inicial) / Valor Inicial × 100. Valores acima da média nacional são sinalizados estatisticamente, não como irregularidade.</div>
    </div>

    <div class="search-wrap" style="margin-bottom:20px;">
      <input class="search-input" id="obrasSearch" type="text" placeholder="Município, órgão ou empresa contratada..." autocomplete="off"/>
      <button class="search-btn" onclick="loadObras()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        Buscar Obras
      </button>
    </div>

    <div class="two-col" style="margin-bottom:20px;">
      <div class="card">
        <div class="card-header"><div class="card-title">Variação % por Modalidade</div></div>
        <div class="card-body"><div class="chart-wrap-lg"><canvas id="chartObrasModalidade"></canvas></div></div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">Top Obras — Maior Variação</div></div>
        <div class="card-body"><div class="chart-wrap-lg"><canvas id="chartObrasTop"></canvas></div></div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-title">Detalhamento das Obras</div>
        <a class="btn btn-source btn-sm" href="https://compras.gov.br" target="_blank">Verificar na fonte oficial →</a>
      </div>
      <div class="card-body" id="obrasList"></div>
    </div>
  </div>
</div>

<!-- ═══════════════ METODOLOGIA ═══════════════ -->
<div class="view" id="view-metodo">
  <div class="method-wrap">
    <div class="section-label">// Transparência metodológica integral</div>
    <div class="method-h">Metodologia — Índice de Exposição Estatística (IEE)</div>
    <p class="method-p">O IEE é um índice estatístico composto por 6 variáveis normalizadas pelo método Min-Max, com pesos inicialmente igualitários (16,67% cada). A fórmula é pública, auditável e o código-fonte está disponível sob licença MIT.</p>

    <div class="method-formula">
      <div class="comment">// Fórmula do IEE — Normalização Min-Max</div>
      <div><span class="highlight">IEE</span> = Σ (Vᵢ_normalizado × Pᵢ) × 100</div>
      <br>
      <div class="comment">// Normalização de cada variável</div>
      <div><span class="highlight">Vᵢ_norm</span> = (Vᵢ - min(V)) / (max(V) - min(V))</div>
      <br>
      <div class="comment">// Variáveis e pesos igualitários</div>
      <div><span class="highlight">V1</span> = Concentração de contratos por órgão    <span class="comment">P = 16.67%</span></div>
      <div><span class="highlight">V2</span> = Crescimento atípico de faturamento (z-score) <span class="comment">P = 16.67%</span></div>
      <div><span class="highlight">V3</span> = % contratos sem concorrência real         <span class="comment">P = 16.67%</span></div>
      <div><span class="highlight">V4</span> = Relação societária com agente público       <span class="comment">P = 16.67%</span></div>
      <div><span class="highlight">V5</span> = Doação seguida de contrato público          <span class="comment">P = 16.67%</span></div>
      <div><span class="highlight">V6</span> = % aditivos acima da média nacional          <span class="comment">P = 16.67%</span></div>
      <br>
      <div class="comment">// Classificação</div>
      <div>0  – 30 → <span class="highlight">Baixa</span> exposição estatística</div>
      <div>31 – 60 → <span class="highlight">Moderada</span> exposição estatística</div>
      <div>61 – 100 → <span class="highlight">Elevada</span> exposição estatística</div>
    </div>

    <p class="method-p">Nenhuma das variáveis implica acusação. Todas representam desvios estatísticos em relação à distribuição nacional de referência calculada com dados históricos dos portais oficiais.</p>

    <div class="section-label" style="margin-top:32px;">// Endpoints utilizados</div>
    <div class="method-h" style="font-size:18px;margin-bottom:12px;">APIs Oficiais Integradas</div>
    <div class="endpoint-list" id="endpointList"></div>

    <div class="section-label" style="margin-top:32px;">// Governança</div>
    <div class="method-h" style="font-size:18px;margin-bottom:12px;">Código Aberto e Contestação</div>
    <p class="method-p">Todo o código-fonte está disponível no GitHub sob licença MIT. Qualquer dado pode ser contestado através do canal oficial da CGU (Fala.BR). Erros identificados serão corrigidos em até 72 horas com registro público do ajuste.</p>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;">
      <a class="btn btn-primary" href="https://github.com" target="_blank">GitHub — Código Fonte (MIT)</a>
      <a class="btn btn-source" href="https://falabr.cgu.gov.br" target="_blank">Contestar Dado — CGU</a>
      <a class="btn btn-outline" href="https://www.gov.br/anpd" target="_blank">ANPD — LGPD</a>
    </div>
  </div>
</div>

<script>
// ═══════════════════════════════════════════
// DADOS DE REFERÊNCIA
// ═══════════════════════════════════════════
const SOURCES_META = [
  { name:"Portal da Transparência", url:"https://api.portaldatransparencia.gov.br/api-de-dados", endpoint:"GET /contratos · /emendas · /servidores", credencial:"Chave gratuita em portaldatransparencia.gov.br/api-de-dados", rate:"500 req/h", desc:"Transferências, emendas, contratos e servidores federais" },
  { name:"TSE — Divulga Cand",      url:"https://divulgacandcontas.tse.jus.br/divulga/rest/v1", endpoint:"GET /candidatura/consultar · /prestacaoContas", credencial:"Sem chave necessária", rate:"Sem limite documentado", desc:"Declaração de bens, doadores, prestação de contas eleitorais" },
  { name:"Receita Federal — CNPJ",  url:"https://www.receitaws.com.br/v1/cnpj",                 endpoint:"GET /{cnpj}", credencial:"Sem chave (gratuito até 3 req/min)", rate:"3 req/min grátis · 100 req/min pago", desc:"Quadro societário, sócios e situação cadastral" },
  { name:"CGU — CEIS / CNEP",       url:"https://api.portaldatransparencia.gov.br/api-de-dados/ceis", endpoint:"GET /ceis · /cnep", credencial:"Mesma chave do Portal da Transparência", rate:"500 req/h", desc:"Empresas e pessoas sancionadas ou inidôneas" },
  { name:"Compras.gov",             url:"https://compras.dados.gov.br",                         endpoint:"GET /contratos · /licitacoes · /fornecedores", credencial:"Sem chave necessária", rate:"Sem limite documentado", desc:"Licitações, contratos e fornecedores federais" },
  { name:"SIAFI — Tesouro",         url:"https://siafi.tesouro.gov.br",                         endpoint:"Dados via Portal da Transparência", credencial:"Via Portal da Transparência", rate:"500 req/h", desc:"Execução orçamentária e financeira federal" },
  { name:"FNDE",                    url:"https://www.fnde.gov.br/financiamento",                endpoint:"CSV/JSON em dados.gov.br", credencial:"Sem chave necessária", rate:"Sem limite", desc:"Transferências para educação (PNAE, PNATE, PDDE)" },
  { name:"INEP — Censo Escolar",    url:"https://www.gov.br/inep",                              endpoint:"Microdados em dados.gov.br", credencial:"Sem chave necessária", rate:"Sem limite", desc:"Matrículas e infraestrutura escolar" },
  { name:"TCU",                     url:"https://portal.tcu.gov.br",                            endpoint:"Jurisprudência e acórdãos via API REST", credencial:"Sem chave necessária", rate:"Sem limite documentado", desc:"Fiscalização de contratos e acórdãos" },
  { name:"RAIS/CAGED — MTE",        url:"https://bi.mte.gov.br",                               endpoint:"Microdados em dados.gov.br", credencial:"Sem chave necessária", rate:"Sem limite", desc:"Vínculos empregatícios, admissões e demissões" },
];

const DEMOS = {
  agente: {
    name:"Carlos Alberto Silva", type:"Agente Público Federal",
    meta:["Deputado Federal","SP","Partido XYZ","Mandato 2019–2027","CPF 123.456.***-**"],
    iee:94, ieeClass:"elevada",
    sourceUrl:"https://transparencia.gov.br",
    aviso:"IEE de 94 indica padrão estatisticamente elevado em 5 das 6 variáveis analisadas. Este índice representa análise estatística de dados públicos e não constitui acusação ou comprovação de irregularidade.",
    variaveis:[
      { nome:"Concentração de contratos por órgão",   raw:"67%",  norm:0.91, peso:"16.67%", contrib:15.2, desc:"67% dos contratos no município de Santo André foram para empresas com sócios de mesmo sobrenome do agente. Média nacional: 18%." },
      { nome:"Crescimento atípico de faturamento",    raw:"z=4.2",norm:0.88, peso:"16.67%", contrib:14.7, desc:"z-score de 4.2 indica faturamento 4,2 desvios padrões acima da média de parlamentares com perfil similar." },
      { nome:"% contratos sem concorrência real",     raw:"83%",  norm:0.95, peso:"16.67%", contrib:15.8, desc:"19 de 23 processos licitatórios tiveram apenas 1 proposta válida. Média nacional para obras: 31%." },
      { nome:"Relação societária com agente público", raw:"Sim",  norm:1.00, peso:"16.67%", contrib:16.7, desc:"ABC Construções Ltda tem sócio-administrador de mesmo sobrenome e CPF com 3 dígitos coincidentes com o agente." },
      { nome:"Doação seguida de contrato público",    raw:"10.8×",norm:0.87, peso:"16.67%", contrib:14.5, desc:"12 empresas doadoras nas prestações de contas TSE 2018/2022 foram posteriormente contratadas. Retorno médio: 10,8×." },
      { nome:"Aditivos contratuais acima da média",   raw:"42%",  norm:0.52, peso:"16.67%", contrib:8.7,  desc:"42% dos contratos possuem aditivos. Média nacional para obras: 28%. Variação de +50% em relação à média." },
    ],
    timeline:[
      { year:"2018", event:"Início do mandato", desc:"Assumiu cargo de Deputado Federal. TSE registra R$380K recebidos de 12 empresas de construção.", sev:"mod" },
      { year:"2019", event:"1ª emenda parlamentar",  desc:"R$8M em emendas direcionadas à Prefeitura de Santo André. ABC Construções vence 3 licitações.", sev:"alta" },
      { year:"2020", event:"Concentração de contratos", desc:"ABC Construções: 7 licitações sem concorrência. Total: R$14M. Sócio: Roberto A. Silva (mesmo sobrenome).", sev:"alta" },
      { year:"2021", event:"Variação FNDE × INEP",   desc:"E.M. Girassol recebe R$800K do FNDE. Censo Escolar INEP: 0 matrículas registradas no período.", sev:"alta" },
      { year:"2022", event:"Renovação de mandato",   desc:"Novas emendas: R$18M. TSE: mesmas 12 empresas doadoras. Padrão estatístico reconfirmado.", sev:"mod" },
      { year:"2023", event:"Duplo vínculo RAIS",     desc:"Cruzamento RAIS × Folha Municipal: 34 CPFs com vínculo simultâneo em empresa privada e ente público.", sev:"alta" },
    ],
    stats:[
      { l:"Valor total em contratos",    v:"R$ 47,3M", s:"período 2019–2023" },
      { l:"Contratos sem concorrência",  v:"83%",      s:"19 de 23 licitações" },
      { l:"Remuneração comissionada",    v:"R$ 710K",  s:"total acumulado" },
      { l:"Fontes consultadas",          v:"10",       s:"portais oficiais" },
    ],
    partido: { sigla:"XYZ", nome:"Partido da Frente Nacional", risco:78, investigados:14, filiacao:"2010", historico:"PDT (2003–2010) → XYZ (2010–atual)",
      aliances:[
        { sigla:"PDT", nome:"João Ferreira dos Santos", cor:"#1e6bb8", role:"Vereador — Rio de Janeiro — RJ", link:"Coligação 2022 + 2 contratos cruzados", iee:88, cls:"alta" },
        { sigla:"PSD", nome:"Maria Conceição Almeida",  cor:"#b91c1c", role:"Senadora — RJ",                  link:"Mesmo grupo de doadores · 3 empresas cruzadas", iee:79, cls:"alta" },
        { sigla:"MDB", nome:"Antônio César Macedo",     cor:"#15803d", role:"Prefeito — Interior SP",          link:"Emenda cruzada 2021 · fornecedor comum",   iee:68, cls:"mod" },
      ]
    },
    cargos:[
      { das:"DAS-4", alto:true, cargo:"Diretor de Infraestrutura", orgao:"Min. do Desenvolvimento Regional", periodo:"Jan/2019 – Dez/2022", meses:48, mensal:"R$ 11.400", total:"R$ 547.200",
        repasse:{ desc:"Durante o período no cargo, R$47M em emendas parlamentares foram direcionadas a municípios que contrataram empresas identificadas com mesmo sobrenome do agente. O agente tinha poder decisório sobre a análise técnica dos projetos.", val:"R$47M em repasses no período", fonte:"SIAFI + Compras.gov", url:"https://siafi.tesouro.gov.br" }},
      { das:"DAS-2", alto:false, cargo:"Assessor Especial de Obras", orgao:"Prefeitura de Santo André – SP", periodo:"Mar/2016 – Dez/2018", meses:34, mensal:"R$ 4.800", total:"R$ 163.200", repasse:null },
    ],
    conexoes:[
      { tipo:"VÍNCULO SOCIETÁRIO", nome:"Roberto A. Silva",         cnpj:"ABC Construções · CNPJ 12.345.678/0001-90", val:"R$31,2M em contratos", cls:"alta" },
      { tipo:"VÍNCULO SOCIETÁRIO", nome:"Lucas A. Silva",           cnpj:"JSJ Comunicação · CNPJ 98.765.432/0001-10", val:"R$8,4M em contratos",  cls:"alta" },
      { tipo:"VÍNCULO POLÍTICO",   nome:"Prefeitura de Santo André",cnpj:"CNPJ 44.374.160/0001-44",                   val:"R$47M em emendas",     cls:"mod" },
      { tipo:"DOADOR TSE",         nome:"12 empresas identificadas", cnpj:"Prestação de contas 2018 e 2022 — TSE",    val:"R$4,1M em contratos",  cls:"mod" },
    ],
    fontes:[
      { name:"Portal da Transparência", url:"https://transparencia.gov.br", ts:"28/02/2026 09:14", hash:"sha256:a3f8..." },
      { name:"TSE — Prestação de Contas", url:"https://prestacaocontas.tse.jus.br", ts:"28/02/2026 09:15", hash:"sha256:b7c2..." },
      { name:"Receita Federal — CNPJ", url:"https://www.receitaws.com.br", ts:"28/02/2026 09:16", hash:"sha256:d1e9..." },
      { name:"Compras.gov", url:"https://compras.gov.br", ts:"28/02/2026 09:17", hash:"sha256:f4a1..." },
      { name:"SIAFI", url:"https://siafi.tesouro.gov.br", ts:"28/02/2026 09:17", hash:"sha256:c8b3..." },
      { name:"FNDE + INEP", url:"https://www.fnde.gov.br", ts:"28/02/2026 09:18", hash:"sha256:e2d7..." },
      { name:"RAIS/CAGED — MTE", url:"https://bi.mte.gov.br", ts:"28/02/2026 09:19", hash:"sha256:a9f5..." },
    ]
  },

  prefeitura: {
    name:"Prefeitura de Belford Roxo — RJ", type:"Ente Municipal",
    meta:["Município","Estado: RJ","Pop: 520.000 hab.","CNPJ 29.113.651/0001-52"],
    iee:89, ieeClass:"elevada",
    sourceUrl:"https://transparencia.gov.br/estados-e-municipios",
    aviso:"IEE de 89 indica concentração estatisticamente atípica em contratos e variações de obras. Análise estatística descritiva — não constitui acusação.",
    variaveis:[
      { nome:"Concentração de contratos por órgão",   raw:"78%",  norm:0.95, peso:"16.67%", contrib:15.8, desc:"78% dos contratos concentrados em 3 empresas. Média municipal RJ: 24%." },
      { nome:"Crescimento atípico de faturamento",    raw:"z=3.1",norm:0.72, peso:"16.67%", contrib:12.0, desc:"Crescimento de faturamento das empresas contratadas 3,1 desvios acima da média estadual." },
      { nome:"% contratos sem concorrência real",     raw:"81%",  norm:0.93, peso:"16.67%", contrib:15.5, desc:"17 de 21 licitações com proposta única. Média estadual: 34%." },
      { nome:"Relação societária com agente público", raw:"Sim",  norm:0.90, peso:"16.67%", contrib:15.0, desc:"Sócios das empresas contratadas com vínculos identificados no quadro funcional municipal." },
      { nome:"Doação seguida de contrato público",    raw:"8.3×", norm:0.80, peso:"16.67%", contrib:13.4, desc:"Doadores identificados no TSE municipal 2020 receberam contratos com retorno médio de 8,3×." },
      { nome:"Aditivos contratuais acima da média",   raw:"67%",  norm:0.89, peso:"16.67%", contrib:14.8, desc:"67% dos contratos com aditivos. Média para municípios de mesmo porte: 29%." },
    ],
    timeline:[
      { year:"2020", event:"Gestão iniciada", desc:"Novos gestores municipais. TSE: doadores identificados nas prestações de contas.", sev:"mod" },
      { year:"2021", event:"Concentração de contratos", desc:"78% dos contratos para 3 empresas com vínculos funcionais identificados.", sev:"alta" },
      { year:"2022", event:"Variação de obras", desc:"9 obras com variação acima de 80% em relação ao valor inicial contratado.", sev:"alta" },
      { year:"2023", event:"FNDE × INEP", desc:"Verbas FNDE declaradas para 12.400 alunos. Censo INEP: 11.200. Diferença: 1.200.", sev:"mod" },
    ],
    stats:[
      { l:"Contratos identificados", v:"R$62,4M", s:"2020–2024" },
      { l:"Obras com variação >80%", v:"9",       s:"acima da média nacional" },
      { l:"Licitações proposta única",v:"81%",    s:"17 de 21 processos" },
      { l:"Fontes consultadas",       v:"10",     s:"portais oficiais" },
    ],
    partido:{ sigla:"PSD", nome:"Partido Social Democrático", risco:68, investigados:9, filiacao:"2015", historico:"PMDB (2008–2015) → PSD (2015–atual)",
      aliances:[
        { sigla:"XYZ", nome:"Carlos Alberto Silva", cor:"#1e6bb8", role:"Deputado Federal — SP", link:"Emenda de R$47M aprovada — Compras.gov",  iee:94, cls:"alta" },
        { sigla:"MDB", nome:"Ricardo Sousa Lima",   cor:"#15803d", role:"Deputado Estadual — RJ", link:"Repasse estadual + empresa cruzada",     iee:74, cls:"alta" },
      ]
    },
    cargos:[
      { das:"CCE-3", alto:true, cargo:"Secretário Municipal de Obras", orgao:"Prefeitura de Belford Roxo — RJ", periodo:"Jan/2021 – atual", meses:38, mensal:"R$ 8.200", total:"R$ 311.600",
        repasse:{ desc:"Responsável técnico pela aprovação de contratos de obras. 78% dos contratos assinados durante sua gestão: empresas com vínculos funcionais no gabinete.", val:"R$38,4M em contratos sob responsabilidade", fonte:"Compras.gov + Portal da Transparência", url:"https://compras.gov.br" }},
    ],
    conexoes:[
      { tipo:"VÍNCULO SOCIETÁRIO", nome:"Construtora BR Forte Ltda", cnpj:"CNPJ 55.123.456/0001-78", val:"R$22,1M em contratos", cls:"alta" },
      { tipo:"VÍNCULO SOCIETÁRIO", nome:"Limpeza Total Serviços",    cnpj:"CNPJ 44.987.321/0001-12", val:"R$9,8M em contratos",  cls:"alta" },
      { tipo:"DOADOR TSE",         nome:"12 doadores — TSE 2020",    cnpj:"Prestação de contas TSE", val:"R$6,5M em contratos",  cls:"mod" },
    ],
    fontes:[
      { name:"Portal da Transparência", url:"https://transparencia.gov.br", ts:"28/02/2026 09:14", hash:"sha256:b2c9..." },
      { name:"Compras.gov — Contratos", url:"https://compras.gov.br", ts:"28/02/2026 09:15", hash:"sha256:d4e1..." },
      { name:"FNDE + INEP", url:"https://www.fnde.gov.br", ts:"28/02/2026 09:16", hash:"sha256:f8a3..." },
      { name:"TSE — Prestação de Contas", url:"https://prestacaocontas.tse.jus.br", ts:"28/02/2026 09:17", hash:"sha256:c1b7..." },
    ]
  }
};

const RANKING = [
  { rank:1, name:"Carlos Alberto Silva",          role:"Deputado Federal — SP · Partido XYZ", iee:94, cls:"alta",  tags:["alta","alta","mod"], demo:"agente",     exp:"R$47,3M" },
  { rank:2, name:"Prefeitura de Belford Roxo — RJ", role:"Município · Grande Rio · PSD",       iee:89, cls:"alta",  tags:["alta","alta"],       demo:"prefeitura", exp:"R$62,4M" },
  { rank:3, name:"João Ferreira dos Santos",      role:"Vereador — Rio de Janeiro — RJ · PDT",iee:88, cls:"alta",  tags:["alta","mod"],         demo:"agente",     exp:"R$28,1M" },
  { rank:4, name:"Prefeitura de Queimados — RJ",  role:"Município · Grande Rio · MDB",         iee:82, cls:"alta",  tags:["alta","alta"],        demo:"prefeitura", exp:"R$31,7M" },
  { rank:5, name:"Maria Conceição Almeida",       role:"Senadora — RJ · PSD",                  iee:79, cls:"alta",  tags:["alta","mod"],         demo:"agente",     exp:"R$24,9M" },
];

const OBRAS_DEMO = [
  { nome:"Pavimentação Av. Central — Belford Roxo/RJ", empresa:"Construtora BR Forte Ltda", modalidade:"Tomada de Preços", vlInicial:"R$2.100.000", vlFinal:"R$3.890.000", variacao:85.2, prazoInicial:"8 meses", prazoFinal:"14 meses", aditivos:3, mediaModal:28 },
  { nome:"Reforma UBS Parque Esperança — Belford Roxo/RJ", empresa:"Limpeza Total Serviços", modalidade:"Convite", vlInicial:"R$480.000", vlFinal:"R$910.000", variacao:89.6, prazoInicial:"4 meses", prazoFinal:"9 meses", aditivos:4, mediaModal:22 },
  { nome:"Escola Mun. Girassol — Santo André/SP", empresa:"ABC Construções Ltda", modalidade:"Concorrência", vlInicial:"R$1.800.000", vlFinal:"R$2.650.000", variacao:47.2, prazoInicial:"12 meses", prazoFinal:"16 meses", aditivos:2, mediaModal:18 },
  { nome:"Drenagem Bairro Nova Vida — Queimados/RJ", empresa:"Terraplan Eng.", modalidade:"Pregão Presencial", vlInicial:"R$3.400.000", vlFinal:"R$3.780.000", variacao:11.2, prazoInicial:"6 meses", prazoFinal:"7 meses", aditivos:1, mediaModal:15 },
];

// ═══════════════════════════════════════════
// ESTADO
// ═══════════════════════════════════════════
let currentMode = 'simples';
let chartsInstances = {};

// ═══════════════════════════════════════════
// NAVEGAÇÃO
// ═══════════════════════════════════════════
function showView(name) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('view-' + name).classList.add('active');
  const nt = document.getElementById('nt-' + name);
  if(nt) nt.classList.add('active');
  window.scrollTo(0,0);
  if(name === 'obras') initObrasCharts();
}

function setMode(m) {
  currentMode = m;
  document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('mb-' + m).classList.add('active');
  const varsSection = document.getElementById('varsSection');
  if(varsSection) varsSection.style.display = m === 'avancado' ? 'block' : 'none';
}

function setSearchType(el, t) {
  document.querySelectorAll('.search-type').forEach(e => e.classList.remove('active'));
  el.classList.add('active');
  const ph = { nome:'Nome do agente público...', cnpj:'CNPJ da empresa (00.000.000/0001-00)...', cargo:'Cargo público (ex: Secretário Municipal)...', cpf:'CPF público (apenas bases oficiais)...' };
  document.getElementById('homeSearch').placeholder = ph[t] || '';
}

// ═══════════════════════════════════════════
// BUSCA E ANÁLISE
// ═══════════════════════════════════════════
function startSearch(query) {
  if(!query || !query.trim()) return;
  showView('analise');
  document.getElementById('analysisSearch').value = query;

  const q = query.toLowerCase();
  const demoKey = (q.includes('prefeitura') || q.includes('belford') || q.includes('queimados') || q.includes('munic')) ? 'prefeitura' : 'agente';
  const demo = DEMOS[demoKey];

  document.getElementById('resultsWrap').classList.remove('visible');
  const lc = document.getElementById('loadingCard');
  lc.classList.add('visible');

  const steps = ['ls1','ls2','ls3','ls4','ls5','ls6','ls7','ls8','ls9'];
  const bar = document.getElementById('ldBar');
  let i = 0;
  steps.forEach(s => { document.getElementById(s).className = 'ld-step'; });

  function next() {
    if(i > 0) document.getElementById(steps[i-1]).className = 'ld-step done';
    if(i < steps.length) {
      document.getElementById(steps[i]).className = 'ld-step active';
      bar.style.width = ((i+1)/steps.length * 100) + '%';
      i++;
      setTimeout(next, 300 + Math.random()*150);
    } else {
      setTimeout(() => {
        lc.classList.remove('visible');
        renderResults(demo);
      }, 300);
    }
  }
  next();
}

// ═══════════════════════════════════════════
// RENDER RESULTS
// ═══════════════════════════════════════════
function renderResults(demo) {
  const ieeColor = demo.iee >= 61 ? 'var(--exp-alta)' : demo.iee >= 31 ? 'var(--exp-mod)' : 'var(--exp-baixa)';
  const ieeClass = demo.iee >= 61 ? 'alta' : demo.iee >= 31 ? 'mod' : 'baixa';
  const ieeLabel = demo.iee >= 61 ? 'Exposição Elevada (IEE 61–100)' : demo.iee >= 31 ? 'Exposição Moderada (IEE 31–60)' : 'Baixa Exposição (IEE 0–30)';

  // Subject
  document.getElementById('rType').textContent = demo.type;
  document.getElementById('rName').textContent = demo.name;
  document.getElementById('rMeta').innerHTML = demo.meta.map(m => `<span class="sc-pill">${m}</span>`).join('');
  document.getElementById('rIEE').textContent = demo.iee;
  document.getElementById('rIEE').style.color = ieeColor;
  document.getElementById('rIEEClass').textContent = ieeLabel;
  document.getElementById('rIEEClass').style.color = ieeColor;
  document.getElementById('rSourceBtn').href = demo.sourceUrl;
  document.getElementById('rAviso').querySelector('#rAvisoText').textContent = demo.aviso;

  // IEE display
  document.getElementById('ieeDisplay').textContent = demo.iee;
  document.getElementById('ieeDisplay').style.color = ieeColor;
  const ieeTag = document.getElementById('ieeTag');
  ieeTag.textContent = `Exposição ${demo.ieeClass === 'elevada' ? 'Elevada' : demo.ieeClass === 'moderada' ? 'Moderada' : 'Baixa'}`;
  ieeTag.className = `tag tag-${ieeClass === 'alta' ? 'alta' : ieeClass === 'mod' ? 'mod' : 'baixa'}`;

  const totalContrib = demo.variaveis.reduce((s,v) => s + v.contrib, 0);
  document.getElementById('ieeFormula').innerHTML =
    `<strong>IEE = Σ (Vᵢ_norm × Pᵢ) × 100</strong><br>` +
    demo.variaveis.map((v,i) =>
      `V${i+1} (${v.norm.toFixed(2)} × ${v.peso}) = <strong>${v.contrib.toFixed(1)}</strong>`
    ).join(' + ') +
    `<br><strong>IEE = ${totalContrib.toFixed(1)} ≈ ${demo.iee}</strong>`;

  // IEE bar
  const ieeBarEl = document.getElementById('ieeBar');
  ieeBarEl.dataset.w = demo.iee;
  ieeBarEl.className = `score-fill fill-${ieeClass === 'alta' ? 'alta' : ieeClass === 'mod' ? 'mod' : 'baixa'}`;

  // Vars grid
  document.getElementById('ieeVars').innerHTML = demo.variaveis.map((v,i) => `
    <div class="iee-var">
      <div class="iee-var-name">V${i+1} — ${v.nome.split(' ').slice(0,3).join(' ')}</div>
      <div class="iee-var-val">${v.raw}</div>
      <div class="iee-var-norm">Norm: ${v.norm.toFixed(2)}</div>
      <div class="iee-var-weight">Contribuição: ${v.contrib.toFixed(1)} pts</div>
    </div>`).join('');

  // Vars detail (modo avançado)
  document.getElementById('varList').innerHTML = demo.variaveis.map((v,i) => {
    const pct = v.norm * 100;
    const clr = pct > 70 ? 'var(--exp-alta)' : pct > 40 ? 'var(--exp-mod)' : 'var(--exp-baixa)';
    return `
    <div class="var-item">
      <div class="var-row">
        <div class="var-name">V${i+1} — ${v.nome}</div>
        <div class="var-score" style="color:${clr}">${v.contrib.toFixed(1)} pts</div>
      </div>
      <div class="var-desc">${v.desc}</div>
      <div class="var-bar"><div class="var-bar-fill" data-w="${pct}" style="background:${clr};width:0%"></div></div>
      <div style="margin-top:5px;display:flex;gap:8px;">
        <span style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);">Valor bruto: ${v.raw}</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);">Normalizado: ${v.norm.toFixed(2)}</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);">Peso: ${v.peso}</span>
      </div>
    </div>`;
  }).join('');
  document.getElementById('varsSection').style.display = currentMode === 'avancado' ? 'block' : 'none';

  // Timeline
  document.getElementById('rTimeline').innerHTML = (demo.timeline||[]).map(t => `
    <div class="tl-item ${t.sev}">
      <div class="tl-year">${t.year}</div>
      <div class="tl-dot"></div>
      <div class="tl-content">
        <div class="tl-event">${t.event}</div>
        <div class="tl-desc">${t.desc}</div>
      </div>
    </div>`).join('');

  // Stats mini
  document.getElementById('rStats').innerHTML = demo.stats.map(s => `
    <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--bg2);">
      <span style="font-size:11px;color:var(--ink3);">${s.l}</span>
      <span style="font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:500;color:var(--ink);">${s.v}</span>
    </div>`).join('');

  // Partido
  const p = demo.partido;
  document.getElementById('partidoHeader').innerHTML = `
    <div class="partido-sigla">${p.sigla}</div>
    <div class="partido-info">
      <div class="partido-nome">${p.nome}</div>
      <div class="partido-meta">Filiado desde ${p.filiacao} · ${p.historico}</div>
    </div>
    <div class="partido-risk">
      <div class="partido-risk-val">${p.risco}</div>
      <div class="partido-risk-lbl">IEE médio · ${p.investigados} agentes</div>
    </div>`;

  document.getElementById('allianceList').innerHTML = p.aliances.map(a => {
    const clr = a.cls === 'alta' ? 'var(--exp-alta)' : a.cls === 'mod' ? 'var(--exp-mod)' : 'var(--exp-baixa)';
    return `
    <div class="alliance-item" onclick="startSearch('${a.nome}')">
      <div class="al-sigla" style="background:${a.cor}">${a.sigla}</div>
      <div style="flex:1">
        <div class="al-name">${a.nome}</div>
        <div class="al-role">${a.role}</div>
        <div class="al-link">↔ ${a.link}</div>
      </div>
      <div class="al-iee">
        <div class="al-iee-val" style="color:${clr}">${a.iee}</div>
        <div class="al-iee-lbl">IEE</div>
      </div>
    </div>`;
  }).join('');

  // Cargos
  const totalCargos = demo.cargos.reduce((s,c) => {
    const n = parseFloat(c.total.replace(/[R$. ]/g,'').replace(',','.'));
    return s + (isNaN(n) ? 0 : n);
  }, 0);
  document.getElementById('cargosTotal').textContent = 'Total: R$ ' + totalCargos.toLocaleString('pt-BR',{minimumFractionDigits:0});

  document.getElementById('cargosList').innerHTML = demo.cargos.map(c => `
    <div class="cargo-item">
      <div class="cargo-row1">
        <div class="das-badge ${c.alto?'alto':''}">${c.das}</div>
        <div class="cargo-nome">${c.cargo}</div>
        <div class="cargo-orgao">${c.orgao}</div>
      </div>
      <div class="cargo-stats">
        <div class="cargo-stat"><div class="cs-lbl">Remuneração Mensal</div><div class="cs-vl">${c.mensal}</div><div class="cs-sub">bruto</div></div>
        <div class="cargo-stat"><div class="cs-lbl">Total Acumulado</div><div class="cs-vl">${c.total}</div><div class="cs-sub">${c.meses} meses</div></div>
        <div class="cargo-stat"><div class="cs-lbl">Período</div><div class="cs-vl" style="font-size:13px">${c.periodo}</div><div class="cs-sub">${c.meses} meses no cargo</div></div>
      </div>
      ${c.repasse ? `
      <div class="repasse-box">
        <div class="repasse-title">Vínculo Estatístico com Repasses no Período</div>
        <div class="repasse-desc">${c.repasse.desc}</div>
        <div class="repasse-val">${c.repasse.val}</div>
        <div style="margin-top:8px">
          <a class="verify-btn" href="${c.repasse.url}" target="_blank">Verificar na fonte: ${c.repasse.fonte} →</a>
        </div>
      </div>` : `<div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--exp-baixa);">✓ Nenhum vínculo estatístico com repasses identificado neste período</div>`}
    </div>`).join('');

  // Conexões
  document.getElementById('connsCount').textContent = `${demo.conexoes.length} vínculos identificados`;
  document.getElementById('connsList').innerHTML = demo.conexoes.map(c => {
    const clr = c.cls === 'alta' ? 'var(--exp-alta)' : c.cls === 'mod' ? 'var(--exp-mod)' : 'var(--exp-baixa)';
    const tagCls = c.cls === 'alta' ? 'alta' : c.cls === 'mod' ? 'mod' : 'baixa';
    return `
    <div class="conn-item">
      <div class="ct">${c.tipo}</div>
      <div class="cn">
        <div class="cn-name">${c.nome}</div>
        <div class="cn-cnpj">${c.cnpj}</div>
      </div>
      <div class="cn-val" style="color:${clr}">${c.val}</div>
      <div class="cn-tag tag tag-${tagCls}">${c.cls === 'alta' ? 'elevada' : c.cls === 'mod' ? 'moderada' : 'baixa'}</div>
    </div>`;
  }).join('');

  // Fontes
  document.getElementById('rTimestamp').textContent = `Coleta: ${demo.fontes[0]?.ts || '—'}`;
  document.getElementById('sourcesList').innerHTML = demo.fontes.map(f => `
    <div class="source-row">
      <div class="sr-name">${f.name}</div>
      <a class="sr-url" href="${f.url}" target="_blank">${f.url}</a>
      <div class="sr-ts">${f.ts}</div>
      <a class="verify-btn" href="${f.url}" target="_blank">Verificar →</a>
    </div>`).join('');

  // Show
  document.getElementById('resultsWrap').classList.add('visible');

  // Animate bars
  setTimeout(() => {
    document.getElementById('ieeBar').style.width = demo.iee + '%';
    document.querySelectorAll('.var-bar-fill').forEach(b => b.style.width = b.dataset.w + '%');
  }, 120);

  // Charts
  setTimeout(() => {
    renderVarsChart(demo);
    renderPieChart(demo);
  }, 200);
}

// ═══════════════════════════════════════════
// CHARTS
// ═══════════════════════════════════════════
function destroyChart(id) {
  if(chartsInstances[id]) { chartsInstances[id].destroy(); delete chartsInstances[id]; }
}

function renderVarsChart(demo) {
  destroyChart('chartVars');
  const ctx = document.getElementById('chartVars').getContext('2d');
  const colors = demo.variaveis.map(v => v.norm > 0.7 ? 'rgba(185,28,28,0.75)' : v.norm > 0.4 ? 'rgba(194,97,12,0.75)' : 'rgba(21,128,61,0.75)');
  chartsInstances['chartVars'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: demo.variaveis.map((_,i) => `V${i+1}`),
      datasets: [{ label:'Contribuição (pts)', data: demo.variaveis.map(v => v.contrib), backgroundColor: colors, borderRadius:4, borderSkipped:false }]
    },
    options: {
      responsive:true, maintainAspectRatio:false,
      plugins: { legend:{display:false}, tooltip:{ callbacks:{ title:(i) => demo.variaveis[i[0].dataIndex].nome, label:(i) => `Contribuição: ${i.raw.toFixed(1)} pts` }}},
      scales: { y:{ beginAtZero:true, max:20, grid:{color:'rgba(0,0,0,0.05)'}, ticks:{font:{family:'JetBrains Mono',size:10}} }, x:{grid:{display:false}, ticks:{font:{family:'JetBrains Mono',size:10}}} }
    }
  });
}

function renderPieChart(demo) {
  destroyChart('chartPie');
  const ctx = document.getElementById('chartPie').getContext('2d');
  chartsInstances['chartPie'] = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: demo.variaveis.map(v => v.nome.split(' ').slice(0,3).join(' ')),
      datasets: [{ data: demo.variaveis.map(v => v.contrib), backgroundColor: ['#b91c1c','#c2610c','#1a56db','#374151','#6b7280','#15803d'], borderWidth:2, borderColor:'#fff' }]
    },
    options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'right', labels:{ font:{family:'JetBrains Mono',size:9}, boxWidth:10, padding:8 }}}}
  });
}

function initObrasCharts() {
  // Modalidade chart
  destroyChart('chartObrasModalidade');
  const ctx1 = document.getElementById('chartObrasModalidade').getContext('2d');
  chartsInstances['chartObrasModalidade'] = new Chart(ctx1, {
    type:'bar',
    data:{
      labels:['Concorrência','Tom. Preços','Pregão','Convite','Dispensa'],
      datasets:[
        { label:'Variação Média %', data:[18,28,15,22,35], backgroundColor:'rgba(26,86,219,0.6)', borderRadius:4 },
        { label:'Média Nacional %', data:[18,28,15,22,35], type:'line', borderColor:'#374151', borderDash:[5,5], borderWidth:2, pointRadius:3, fill:false }
      ]
    },
    options:{ responsive:true, maintainAspectRatio:false, plugins:{legend:{labels:{font:{family:'JetBrains Mono',size:9}}}}, scales:{y:{beginAtZero:true,ticks:{font:{family:'JetBrains Mono',size:9}}},x:{ticks:{font:{family:'JetBrains Mono',size:9}}}}}
  });

  // Top obras
  destroyChart('chartObrasTop');
  const ctx2 = document.getElementById('chartObrasTop').getContext('2d');
  chartsInstances['chartObrasTop'] = new Chart(ctx2, {
    type:'bar',
    data:{
      labels: OBRAS_DEMO.map(o => o.nome.split('—')[0].trim().substring(0,22)+'...'),
      datasets:[
        { label:'Variação % obra', data: OBRAS_DEMO.map(o => o.variacao), backgroundColor: OBRAS_DEMO.map(o => o.variacao > o.mediaModal*2 ? 'rgba(185,28,28,0.7)' : 'rgba(194,97,12,0.7)'), borderRadius:4 },
        { label:'Média da modalidade %', data: OBRAS_DEMO.map(o => o.mediaModal), type:'line', borderColor:'#1a56db', borderDash:[5,5], borderWidth:2, pointRadius:4, fill:false }
      ]
    },
    options:{
      indexAxis:'y', responsive:true, maintainAspectRatio:false,
      plugins:{legend:{labels:{font:{family:'JetBrains Mono',size:9}}}},
      scales:{x:{beginAtZero:true,ticks:{font:{family:'JetBrains Mono',size:9}}},y:{ticks:{font:{family:'JetBrains Mono',size:9}}}}
    }
  });

  // Obras list
  document.getElementById('obrasList').innerHTML = OBRAS_DEMO.map(o => {
    const above = o.variacao > o.mediaModal;
    const clr = o.variacao > o.mediaModal*2 ? 'var(--exp-alta)' : o.variacao > o.mediaModal ? 'var(--exp-mod)' : 'var(--exp-baixa)';
    return `
    <div class="obra-item">
      <div class="obra-row1">
        <div>
          <div class="obra-nome">${o.nome}</div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--silver);margin-top:2px;">${o.empresa} · ${o.modalidade}</div>
        </div>
        <div class="obra-var">
          <div class="obra-var-val" style="color:${clr}">+${o.variacao}%</div>
          <div class="obra-var-lbl">variação</div>
        </div>
      </div>
      <div class="obra-stats">
        <div class="obra-stat"><div class="os-lbl">Valor Inicial</div><div class="os-vl">${o.vlInicial}</div></div>
        <div class="obra-stat"><div class="os-lbl">Valor Final</div><div class="os-vl">${o.vlFinal}</div></div>
        <div class="obra-stat"><div class="os-lbl">Prazo Inicial</div><div class="os-vl">${o.prazoInicial}</div></div>
        <div class="obra-stat"><div class="os-lbl">Prazo Final</div><div class="os-vl">${o.prazoFinal}</div></div>
        <div class="obra-stat"><div class="os-lbl">Nº Aditivos</div><div class="os-vl">${o.aditivos}</div></div>
      </div>
      <div class="obra-compare">
        Média nacional (${o.modalidade}): <span>${o.mediaModal}%</span>
        — esta obra: <span style="color:${clr}">${o.variacao}%</span>
        — ${above ? `+${(o.variacao - o.mediaModal).toFixed(1)}pp acima` : `dentro da média`}
      </div>
      <div style="margin-top:8px;">
        <a class="verify-btn" href="https://compras.gov.br" target="_blank">Verificar em Compras.gov →</a>
      </div>
    </div>`;
  }).join('');
}

function loadObras() { initObrasCharts(); }

// ═══════════════════════════════════════════
// HOME RANKING
// ═══════════════════════════════════════════
function initHome() {
  document.getElementById('rankingGrid').innerHTML = RANKING.map((r,i) => {
    const clr = r.iee >= 61 ? 'var(--exp-alta)' : r.iee >= 31 ? 'var(--exp-mod)' : 'var(--exp-baixa)';
    return `
    <div class="rank-card" style="animation:fadeUp .3s ${i*.07}s both" onclick="startSearch('${r.name}')">
      <div class="rank-num-block"><div class="rank-num">${r.rank}</div><div class="rank-lbl">IEE</div></div>
      <div class="rank-body">
        <div class="rank-name">${r.name}</div>
        <div class="rank-role">${r.role}</div>
        <div class="rank-tags">${r.tags.map(t=>`<span class="tag tag-${t === 'alta' ? 'alta' : t === 'mod' ? 'mod' : 'baixa'}">${t === 'alta' ? 'Exposição Elevada' : t === 'mod' ? 'Exposição Moderada' : 'Exposição Baixa'}</span>`).join('')}</div>
      </div>
      <div class="rank-right">
        <div class="iee-val" style="color:${clr}">${r.iee}</div>
        <div class="iee-lbl">IEE</div>
        <div class="rank-exp" style="margin-top:6px">${r.exp}</div>
      </div>
    </div>`;
  }).join('');

  // Endpoints
  document.getElementById('endpointList').innerHTML = SOURCES_META.map(s => `
    <div class="endpoint-item">
      <div><span class="ep-method">GET</span><span class="ep-url"><a href="${s.url}" target="_blank">${s.url}</a></span></div>
      <div class="ep-desc">${s.desc} · <strong>Credencial:</strong> ${s.credencial} · <strong>Rate:</strong> ${s.rate}</div>
    </div>`).join('');
}

// ═══════════════════════════════════════════
// PDF
// ═══════════════════════════════════════════
function gerarPDF() {
  alert('Em produção: o backend Python (FastAPI + ReportLab) gera o PDF com:\n\n• Título: "Relatório Técnico de Consolidação de Dados Públicos"\n• IEE com fórmula completa e cálculo detalhado\n• Linha temporal dos dados\n• Gráficos embutidos\n• QR codes para cada fonte\n• Hash SHA-256 de integridade\n• Aviso legal e metodologia\n• Conformidade LGPD\n\nEndpoint: POST /api/gerar-pdf');
}

// ═══════════════════════════════════════════
// KEYBOARD
// ═══════════════════════════════════════════
['homeSearch','analysisSearch'].forEach(id => {
  const el = document.getElementById(id);
  if(el) el.addEventListener('keydown', e => { if(e.key === 'Enter') startSearch(el.value); });
});

// ═══════════════════════════════════════════
// INIT
// ═══════════════════════════════════════════
initHome();
</script>
</body>
</html>
